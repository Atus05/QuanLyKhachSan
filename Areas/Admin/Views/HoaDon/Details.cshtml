@model QuanLyKhachSan.Models.HoaDon

@{
    ViewBag.Title = "Chi tiết Hóa Đơn";
    Layout = "~/Views/Shared/_AdminLayout.cshtml";
}

<h2>Chi tiết Hóa Đơn</h2>
<h4>Đơn hàng #@Model.DatPhongId - Khách: @Model.DatPhong.NguoiDung.HoTen</h4>

<div class="row">
    @* Cột 1: Thông tin tổng quan và Thanh toán *@
    <div class="col-lg-4">
        <div class="card shadow-lg mb-4 border-primary">
            <div class="card-header bg-primary text-white">
                <i class="bi bi-info-circle me-1"></i> Thông tin Hóa Đơn
            </div>
            <div class="card-body">
                <p><strong>Mã Đơn Hàng:</strong> #@Model.DatPhongId</p>
                <p><strong>Ngày Xuất:</strong> @Model.NgayXuat.ToString("dd/MM/yyyy HH:mm")</p>
                <p><strong>Trạng Thái:</strong> <span class="badge bg-success">@Model.TrangThaiThanhToan</span></p>
                <hr />
                <h5>Thông tin Thanh toán</h5>
                <p><strong>Tổng Tiền:</strong> <span class="float-end text-success fs-5">@Model.TongTien.ToString("N0") ₫</span></p>
                <p><strong>Phương Thức:</strong> @Model.PhuongThucThanhToan</p>
                <p><strong>Tiền Đặt Cọc:</strong> <span class="float-end text-danger">- @Model.DatPhong.TienDatCoc.ToString("N0") ₫</span></p>
            </div>
        </div>

        <a href="@Url.Action("Index", "HoaDon")" class="btn btn-secondary w-100"><i class="bi bi-arrow-left me-1"></i> Trở về Danh sách</a>
    </div>

    @* Cột 2: Chi tiết sử dụng (Phòng và Dịch vụ) *@
    <div class="col-lg-8">
        <div class="card shadow-sm mb-4">
            <div class="card-header bg-secondary text-white">
                <i class="bi bi-list-check me-1"></i> Chi tiết sử dụng dịch vụ & phòng
            </div>
            <div class="card-body">
                <h5>1. Thông tin Đặt Phòng</h5>
                <p>
                    <strong>Khách hàng:</strong> @Model.DatPhong.NguoiDung.HoTen <br />
                    <strong>Check-in thực tế:</strong> @Model.DatPhong.NgayCheckIn.ToString("dd/MM/yyyy") <br />
                    <strong>Check-out:</strong> @Model.DatPhong.NgayCheckOut.ToString("dd/MM/yyyy")
                </p>

                <h5 class="mt-4">2. Phòng đã sử dụng</h5>
                <table class="table table-sm table-bordered">
                    <thead>
                        <tr>
                            <th>Số phòng</th>
                            <th>Loại phòng</th>
                            <th>Giá/Ngày</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var dpp in Model.DatPhong.DatPhongPhongs)
                        {
                            <tr>
                                <td>@dpp.Phong.SoPhong</td>
                                <td>@dpp.Phong.LoaiPhong.TenLoai</td>
                                <td>@dpp.Phong.GiaPhong.ToString("N0") ₫</td>
                            </tr>
                        }
                    </tbody>
                </table>

                <h5 class="mt-4">3. Dịch vụ đã sử dụng</h5>
                @if (Model.DatPhong.DichVuSuDungs != null && Model.DatPhong.DichVuSuDungs.Any())
                {
                    <table class="table table-sm table-bordered">
                        <thead>
                            <tr>
                                <th>Dịch vụ</th>
                                <th>Giá</th>
                                <th>Số lượng</th>
                                <th>Thành tiền</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var dvs in Model.DatPhong.DichVuSuDungs)
                            {
                                <tr>
                                    <td>@dvs.DichVu.TenDichVu</td>
                                    <td>@dvs.DichVu.Gia.ToString("N0") ₫</td>
                                    <td>@dvs.SoLuong</td>
                                    <td>@((dvs.SoLuong * dvs.DichVu.Gia).ToString("N0")) ₫</td>
                                </tr>
                            }
                        </tbody>
                    </table>
                }
                else
                {
                    <p class="text-muted">Không có dịch vụ nào được thêm vào đơn hàng này.</p>
                }
            </div>
        </div>
    </div>
</div>